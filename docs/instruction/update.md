
# Інструкції з оновлення системи

Цей документ містить покрокові рекомендації для інженерів з розгортання та DevOps щодо оновлення Telegram-бота у виробничому середовищі.

## 1. Підготовка до оновлення

### Створення резервних копій

Перед будь-яким оновленням обов'язково створіть резервні копії всіх критично важливих даних та конфігураційних файлів.

**Код проєкту:** Зробіть Git Pull у окрему тимчасову директорію або просто заархівуйте поточну версію коду.

```
sudo tar -czvf /var/backups/mytgbot_code_$(date +%Y%m%d%H%M%S).tar.gz /opt/mytgbot
```

**Файли даних JSON:** Скопіюйте всі файли .json (faq.json, appointments.json, languages.json тощо) у безпечне місце.

```
sudo cp /opt/mytgbot/*.json /var/backups/mytgbot_data_$(date +%Y%m%d%H%M%S)/
```

**Конфігураційний файл служби:** Збережіть файл systemd служби.

```
sudo cp /etc/systemd/system/telegram_bot.service /var/backups/
```

Створіть окрему папку для бекапів та переконайтеся, що вона має відповідні права доступу.

### Перевірка сумісності

- Перегляньте журнал змін (changelog) або нотатки до нового релізу, щоб переконатися у відсутності критичних змін.
- Якщо є зміни в `requirements.txt`, перевірте їх сумісність з існуючим середовищем.

### Планування часу простою

Оновлення зазвичай вимагає короткочасного простою. Заплануйте його на період мінімальної активності користувачів.

## 2. Процес оновлення

### Зупинка служби бота

```
sudo systemctl stop telegram_bot.service
```

Переконайтеся, що служба зупинена:

```
sudo systemctl status telegram_bot.service
```

### Перехід до директорії проєкту та оновлення коду

```
cd /opt/mytgbot/
sudo git pull origin master
```

### Якщо були зміни в `requirements.txt`:

```
source .venv/bin/activate
pip install -r requirements.txt
deactivate
```

Переконайтеся, що всі конфігураційні файли оновлені.

### Міграція даних (якщо потрібно)

Якщо структура JSON-файлів змінилася, можливо, потрібно буде написати скрипт для конвертації.

## 3. Перевірка після оновлення

### Перевірка статусу служби

```
sudo systemctl status telegram_bot.service
```

Має бути `active (running)`.

### Перегляд логів

```
sudo journalctl -u telegram_bot.service -f
```

### Функціональне тестування

- Виконайте базові тести в Telegram (команда `/start`, запит FAQ, спроба запису).
- Переконайтеся, що всі функції працюють належним чином.
